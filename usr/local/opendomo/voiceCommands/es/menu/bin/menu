#!/bin/bash
read ESPEAK < /etc/opendomo/speech/espeak.dat
read menu < /usr/local/opendomo/vr/MENU
if [ "$1" = "0" ]
then
	# This option, restarts MENU, to the first level	
	/usr/local/opendomo/vr/espeak.sh Menu0
	echo "menu0" > /usr/local/opendomo/vr/MENU
elif [ "$1" = "21" ]
then
	#21 ==> Salir del modo menú
	/usr/local/opendomo/vr/espeak.sh Menusalir
	echo "no" > /usr/local/opendomo/vr/MENU
elif [ "$1" = "20" ]
then
	#20 ==> Volver al menu anterior.
	# Por reagrupación de codige mejor tratarlo junto
	case "$menu" in
	menu0)
		#20 ==> Volver. En este caso, como estamos en el Menu principal (Menu0) repetimos el mismo Menu0
		/usr/local/opendomo/vr/espeak.sh Menu0
		echo "menu0" > /usr/local/opendomo/vr/MENU
		;;
	menu1|menu2|menu3)	
		#20 ==> Volver
		/usr/local/opendomo/vr/espeak.sh Menu0
		echo "menu0" > /usr/local/opendomo/vr/MENU
		;;		
	menu11|menu12)
		#20 ==> Volver
		/usr/local/opendomo/vr/espeak.sh Menu1e
		echo "menu1" > /usr/local/opendomo/vr/MENU
		;;
	menu3x)
		#20 ==> Volver
		$ESPEAK < /etc/opendomo/speech/configmenu.txt
		echo "menu3" > /usr/local/opendomo/vr/MENU
		;;
	menu111|menu112|menu113|menu114|menu115|menu116|menu117)
		# This option, restarts MENU, to the previous level	
		/usr/local/opendomo/vr/espeak.sh Menu11e
		echo "menu11" > /usr/local/opendomo/vr/MENU
		;;
	esac


else
	
	#Clean posible "opción" prefix
	par1=`echo $1 |cut -d " " -f1 -`
	if [ "$par1" = "opción" ]
	then
		p1=`echo $1 |cut -d " " -f2 -`
	else
		p1=`echo $1 |cut -d " " -f1 -`
	fi
	case "$menu" in
	no)
		/usr/local/opendomo/vr/espeak.sh MenuNo
		;;	
	menu0)
		case "$p1" in
			1)
			/usr/local/opendomo/vr/espeak.sh Menu1e
			echo "menu1" > /usr/local/opendomo/vr/MENU 
			;;
			2)
			/usr/local/opendomo/vr/espeak.sh Menu2e
			echo "menu2" > /usr/local/opendomo/vr/MENU
			;; 
			3)
			$ESPEAK < /etc/opendomo/speech/configmenu.txt
			echo "menu3" > /usr/local/opendomo/vr/MENU
			;;
			else)
			#Opción no válida. Repetir opciones de menu, y quedarse en el mismo estado
			/usr/local/opendomo/vr/espeak.sh Menunoval Menu0
			;;   
		esac
		;;
	menu1)
		case "$p1" in
			1)
			#Listar controladores
			# Agrupar controladores por tipo, de acuerdo a lo que hay en AYUDA
			/usr/local/opendomo/vr/espeak.sh Menu11e
			echo "menu11" > /usr/local/opendomo/vr/MENU
			;; 
			2)
			#Cambiar estado
			#Preguntar estado  y acabar
			/usr/local/opendomo/vr/espeak.sh Menu12e
			echo "menu12" > /usr/local/opendomo/vr/MENU
			;; 

			else)
			#Opción no válida. Repetir opciones de menu, y quedarse en el mismo estado
			/usr/local/opendomo/vr/espeak.sh Menunoval Menu1e
			;;   

		esac
		;;
	menu3)
		#get the script to be run:
		line=`grep $p1 /etc/opendomo/speech/CONFIG`
		script=`echo -n $line | cut -d":" -f2-`
		echo "menu3x" > /usr/local/opendomo/vr/MENU
		;;
	menu11)
		case "$p1" in
			1)
			#Luces
			# 
			$ESPEAK < /etc/opendomo/speech/lightmenu.txt
			echo "menu111" > /usr/local/opendomo/vr/MENU
			;; 
			2)
			#Clima
			# 
			$ESPEAK < /etc/opendomo/speech/climamenu.txt
			echo "menu112" > /usr/local/opendomo/vr/MENU
			;; 
			3)
			#Musica
			# 
			$ESPEAK < /etc/opendomo/speech/musicmenu.txt
			echo "menu113" > /usr/local/opendomo/vr/MENU
			;; 
			4)
			#VideoVigilancia
			# 
			$ESPEAK < /etc/opendomo/speech/videomenu.txt
			echo "menu114" > /usr/local/opendomo/vr/MENU
			;; 
			5)
			#Sensores
			# 
			$ESPEAK < /etc/opendomo/speech/sensorsmenu.txt
			echo "menu115" > /usr/local/opendomo/vr/MENU
			;; 
			6)
			#Termostatos
			# 
			$ESPEAK < /etc/opendomo/speech/varclimatemenu.txt
			echo "menu116" > /usr/local/opendomo/vr/MENU
			;; 
			7)
			#Reguladores de Luz
			# 
			$ESPEAK < /etc/opendomo/speech/varlightmenu.txt
			echo "menu117" > /usr/local/opendomo/vr/MENU
			;; 

			else)
			#Opción no válida. Repetir opciones de menu, y quedarse en el mismo estado
			/usr/local/opendomo/vr/espeak.sh Menunoval Menu11e
			;;   

		esac
		;;
	menu12)
		case "$p1" in
			1)
			#Pasar a modo activo
			#
			/usr/local/opendomo/setSystemState.sh activ
			/usr/local/opendomo/vr/espeak.sh Menucambestactiv
			;; 
			2)
			#Pasar a modo vigilancia
			#
			/usr/local/opendomo/setSystemState.sh secured
			/usr/local/opendomo/vr/espeak.sh Menucambestvig
			;; 
			3)
			#Pasar a modo desactivado
			#Volver luego al menu anterior
			/usr/local/opendomo/setSystemState.sh sleeping
			/usr/local/opendomo/vr/espeak.sh Menucambestdesac
			;; 
		
			else)
			#Opción no válida. Repetir opciones de menu, y quedarse en el mismo estado
			/usr/local/opendomo/vr/espeak.sh Menunoval Menu12
			;;   

		esac
		;;
	menu111)
		#Here, use original string($1).No "opcion" prefix in this case prefix is "activar/desactivar"
		#Fields <activar/desactivar> nrzone  
		par1=`echo $1 |cut -d " " -f1 -`
		par2=`echo $1 |cut -d " " -f2 -`	 
		zona=`grep $par2 /etc/opendomo/speech/lightmenu.txt |  cut -d " " -f1 -`
		if [ "$par1" = "activar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/LucesON $zona
		elif [ "$par1" = "desactivar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/LucesOFF $zona
		else
			/usr/local/opendomo/vr/espeak.sh MenuONOFF
		fi		
		;;
	menu112)
		#Here, use original string($1).No "opcion" prefix in this case prefix is "activar/desactivar"
		#Fields <activar/desactivar> nrzone  
		par1=`echo $1 |cut -d " " -f1 -`
		par2=`echo $1 |cut -d " " -f2 -`	 
		zona=`grep $par2 /etc/opendomo/speech/climamenu.txt |  cut -d " " -f1 -`
		if [ "$par1" = "activar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/ClimaON $zona
		elif [ "$par1" = "deactivar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/ClimaOFF $zona
		else
			/usr/local/opendomo/vr/espeak.sh MenuONOFF
		fi		
		;;
	menu113)
		#Here, use original string($1).No "opcion" prefix in this case prefix is "activar/desactivar"
		#Fields <activar/desactivar> nrzone  
		par1=`echo $1 |cut -d " " -f1 -`
		par2=`echo $1 |cut -d " " -f2 -`	 
		zona=`grep $par2 /etc/opendomo/speech/musicmenu.txt |  cut -d " " -f1 -`		

		if [ "$par1" = "activar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/MusicON $zona
		elif [ "$par1" = "desactivar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/MusicOFF $zona
		else
			/usr/local/opendomo/vr/espeak.sh MenuONOFF
		fi		
		;;
	menu114)
		#Here, use original string($1).No "opcion" prefix in this case prefix is "activar/desactivar"		
		#Fields <activar/desactivar> nrzone   
		par1=`echo $1 |cut -d " " -f1 -`
		par2=`echo $1 |cut -d " " -f2 -`	 
		zona=`grep $par2 /etc/opendomo/speech/videomenu.txt |  cut -d " " -f1 -`		 
	
		if [ "$par1" = "activar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/VideoON $zona
		elif [ "$par1" = "desactivar" ]
		then
			/usr/local/opendomo/vr/Recognition/bin/VideoOFF $zona
		else
			/usr/local/opendomo/vr/espeak.sh MenuONOFF
		fi		
		;;
	menu115)
		#Here, "opción" is applicable..., use $p1,filtered
		#Field nrsensor
		 zona=`grep $p1 /etc/opendomo/speech/sensorsmenu.txt |  cut -d " " -f1 -`
		/usr/local/opendomo/vr/Recognition/bin/Sensors $zona
		;;
	menu116)
		#Here, use original string($1)...No "opcion" as prefix in this case
		#Fields "value" nrzone value(ºC)  
		par1=`echo $1 |cut -d " " -f1 -`
		par2=`echo $1 |cut -d " " -f2 -`	 
		zona=`grep $par1 /etc/opendomo/speech/varclimatemenu.txt |  cut -d " " -f1 -`
		#VarClimate has 1 parameter with both parameters, separated by one space
		line=$zona" "$par2
		/usr/local/opendomo/vr/Recognition/bin/VarClimate $line
		;;
	menu117)
		#Here, use original string($1)...No "opcion" as prefix in this case
		#Fields "value" nrzone value(%)  
		par1=`echo $1 |cut -d " " -f1 -`
		par2=`echo $1 |cut -d " " -f2 -`	 
		zona=`grep $par1 /etc/opendomo/speech/varlightmenu.txt |  cut -d " " -f1 -`
		#VarClimate has 1 parameter with both parameters, separated by one space
		line=$zona" "$par2
		/usr/local/opendomo/vr/Recognition/bin/VarLight $line
		;;	 		 			 			 			 			 		 	
	esac
fi

